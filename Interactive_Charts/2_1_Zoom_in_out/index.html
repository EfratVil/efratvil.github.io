<!DOCTYPE html>
<meta charset="utf-8">
<p id="g1"></p>
<p id="g3"></p>
<script src="//d3js.org/d3.v4.min.js"></script>
<script>

        var data = [],
            random = d3.randomNormal();

        for (i = 0; i < 120; i++) {
            data.push({
                id: i + 1,
                y: random()
            });
        }
     
        var margin = { top: 20, right: 20, bottom: 30, left: 30 };
        width = 500 - margin.left - margin.right,
        height = 300 - margin.top - margin.bottom;

        var x = d3.scaleLinear()
            .range([0, width]);

        var y = d3.scaleLinear()
            .range([height, 0]);
    
        var xAxis = d3.axisBottom(x).ticks(12),
            yAxis = d3.axisLeft(y).ticks(12 * height / width);

        var brush = d3.brush().extent([[0, 0], [width, height]]).on("end", brushended),
            idleTimeout,
            idleDelay = 350;


        function Create_scatter(chart) {

            var svg = d3.select("#" + chart).append("svg")
                        .attr("id", chart + "_svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            x.domain(d3.extent(data, function (d) { return d.id; })).nice();
            
            y.domain([d3.min(data, function (d) { return d.y; }), d3.max(data, function (d) { return d.y; })]).nice();

            svg.selectAll(".dot")
                .data(data)
              .enter().append("circle")
                .attr("class", "dot")
                .attr("r", 4)
                .attr("cx", function (d) { return x(d.id); })
                .attr("cy", function (d) { return y(d.y); })
                .attr("opacity", 0.8)
                .style("fill", "#4292c6");

            svg.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            svg.append("g")
                .attr("class", "axis axis--y")
                .call(yAxis);

            svg.selectAll(".domain")
                .style("display", "none");

            //svg.append("g")
            //    .attr("class", "brush")
            //    .call(brush).extent([[0, 0], [width, height]]).on("brush", brushed).on("end", brushended);

            svg.append("g").attr("class", "brush")
      .call(d3.brush().extent([[0, 0], [width, height]])).call(brush);  //.on("end", brushended).on("brush", brushed)

         }



        Create_scatter("g1");

function brushended() {
    
  var s = d3.event.selection;
  if (!s) {
    if (!idleTimeout) return idleTimeout = setTimeout(idled, idleDelay);
    x.domain(d3.extent(data, function (d) { return d.id; })).nice();
    y.domain([d3.min(data, function (d) { return d.y; }), d3.max(data, function (d) { return d.y; })]).nice();

  } else {
      x.domain([s[0][0], s[1][0]].map(x.invert, x));
      y.domain([s[1][1], s[0][1]].map(y.invert, y))

      d3.select(".brush").call(brush.move, null);

  }
  zoom();
}

function idled() {
  idleTimeout = null;
}

function zoom( ) {
    var s = d3.event.selection;

    var svg = d3.select("#g1_svg"); //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
  var t = svg.transition().duration(750);
  svg.select(".axis--x").transition(t).call(xAxis);
  svg.select(".axis--y").transition(t).call(yAxis);
  svg.selectAll("circle").transition(t)
      .attr("cx", function (d) { return x(d.id); })
      .attr("cy", function (d) { return y(d.y); });


  if (s) {

      //var s = d3.event.selection,
            var x0 = s[0][0],
             y0 = s[0][1],
             dx = s[1][0] - x0,
             dy = s[1][1] - y0;
      console.log(s);

      //console.log(s);
      //x0 = s[0][0],
      //    y0 = s[0][1],
      //    dx = s[1][0] - x0,
      //    dy = s[1][1] - y0;

     
      svg.selectAll('circle')
        .style("fill", function (d) {
            if (x(d.x) >= x0 && x(d.x) <= x0 + dx && y(d.y) >= y0 && y(d.y) <= y0 + dy)
            { return "red"; } // #ec7014
            else { return "green"; }  //
        });

          //.style("fill", function (d) {
          //     if (x(d.x) >= x0) 
          //     { return "#4292c6"; }
          //     else { return "#ec7014"; }
          // });
  }

}

</script>
